___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Teams Notification",
  "categories": [
    "UTILITY"
  ],
  "brand": {
    "id": "brand_dummy",
    "displayName": "SEM Technology",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAylpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDkuMS1jMDAxIDc5LjE0NjI4OTk3NzcsIDIwMjMvMDYvMjUtMjM6NTc6MTQgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCAyNS4zIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkRCQzY3Qjc5QTc3RTExRUU5OUQ3QTE0M0FBNUFBODg4IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkRCQzY3QjdBQTc3RTExRUU5OUQ3QTE0M0FBNUFBODg4Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6REJDNjdCNzdBNzdFMTFFRTk5RDdBMTQzQUE1QUE4ODgiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6REJDNjdCNzhBNzdFMTFFRTk5RDdBMTQzQUE1QUE4ODgiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4umPeaAAAJrElEQVR4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\u003d\u003d"
  },
  "description": "Send a notification to Microsoft Teams, using \"Incoming Webhook\" feature.",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "WebhookURL",
    "displayName": "Webhook URL",
    "simpleValueType": true,
    "alwaysInSummary": true,
    "notSetText": "Webhook URL is Required."
  },
  {
    "type": "RADIO",
    "name": "RequestBodyType",
    "displayName": "Request Content Type",
    "radioItems": [
      {
        "value": "JSONContent",
        "displayValue": "JSON Content"
      },
      {
        "value": "RawText",
        "displayValue": "Raw Text"
      }
    ],
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "Content",
    "displayName": "Content",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "RequestBodyType",
        "paramValue": "JSONContent",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "RawText",
    "displayName": "Text",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "RequestBodyType",
        "paramValue": "RawText",
        "type": "EQUALS"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_SERVER___

const sendHttpRequest = require('sendHttpRequest');

const postHeaders = {'Content-Type': 'application/json'};
const url = data.WebhookURL;
let postBody;
if (data.RequestBodyType === "JSONContent") {
  postBody = data.Content;
} else if (data.RequestBodyType === "RawText") {
  postBody = '{"text": "'+data.RawText+'"}';
}

sendHttpRequest(url, (statusCode, headers, body) => {
  if (statusCode >= 200 && statusCode < 300) {
    data.gtmOnSuccess();
  } else {
    data.gtmOnFailure();
  }
}, {headers: postHeaders, method: 'POST', timeout: 3000}, postBody);


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "send_http",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://*.webhook.office.com/webhookb2/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 2024/1/10 10:58:13


